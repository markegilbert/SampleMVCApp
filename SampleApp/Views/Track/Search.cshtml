@using Microsoft.AspNetCore.Mvc.Routing
@model SampleApp.Models.TrackSearchModel

@{
    ViewData["Title"] = "Track Search";
}

@section StyleSheets
{
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.0/themes/base/jquery-ui.css">
}

<h1>Track Search</h1>

@using (Html.BeginForm("Search", "Track", FormMethod.Post, new { @id = "formID"}))
{        
    @Html.AntiForgeryToken()
    <div class="form-group row my-1">
        @Html.LabelFor(m => m.TrackName, new { @class = "col-sm-2 col-md-1 col-form-label"})
        <div class="col-sm-10 col-md-4">
            @Html.TextBoxFor(m => m.TrackName, new { @class = "form-control" })
            <div class="invalid-feedback d-block">
                @Html.ValidationMessageFor(m => m.TrackName)
            </div>
        </div>
    </div>
    <div class="form-group row my-1">
        @Html.LabelFor(m => m.ArtistName, new { @class = "col-sm-2 col-md-1 col-form-label" })
        <div class="col-sm-10 col-md-4">
            @Html.TextBoxFor(m => m.ArtistName, new { @class = "form-control" })
            <div class="invalid-feedback d-block">
                @Html.ValidationMessageFor(m => m.ArtistName)
            </div>
        </div>
    </div>
    <input type="submit" value="Search" class="btn btn-primary" />
}

@if (Model.Results != null)
{
    <div class="my-5">
        <h2>Search Results</h2>

        <div class="container">
        @foreach (TrackSearchResultModel CurrentResult in Model.Results)
        {
                <div class="row">
                    <div class="col">@CurrentResult.TrackName / @CurrentResult.ArtistName</div>
                    <div class="col">
                        <button class="album-art-dialog" data-url="@Url.Action("AlbumArt", "Track", new { TrackName = @CurrentResult.TrackName, ArtistName = @CurrentResult.ArtistName } )">Album Art</button>
                    </div>
                </div>
        }
        </div>
    </div>
}

<div id="dialog" title="Album Art">
    
</div>



@section Scripts
{
    <partial name="_ValidationScriptsPartial.cshtml" />

    <script src="https://code.jquery.com/ui/1.14.0/jquery-ui.min.js"></script>

    <script>
        $(document).ready(function () {
            // Initialize the dialog but keep it closed
            $("#dialog").dialog({
                autoOpen: false
            });

            // Open the dialog on button click
            $(".album-art-dialog").click(function () {
                // Extract the URL from the clicked button
                var Url = $(event.target).data('url');

                // Clear out the DIV so the previous image isn't displayed, even briefly.
                $("#dialog").empty();

                // Append the content to the DIV
                $.get(Url, function (data) {
                    $("#dialog").append(data);
                });

                // Display the div
                $("#dialog").dialog("open");
            });
        });
    </script>
}